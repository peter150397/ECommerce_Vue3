import{_ as b,a as _,r as v,o as d,c,b as t,t as u,F as g,k as y,i as I,l as f,p as x,e as D}from"./index-11adf39a.js";import{P as k}from"./Pagination-b16c05b0.js";const P={data(){return{orders:[],products:[],pagination:{},totalIncome:0,totalDebt:0}},components:{Pagination:k},methods:{getOrderList(e=1){const n=`https://vue-course-api.hexschool.io/api/peterapi/orders?page=${e}`,r=this;this.$switchLoadingStatus.switchLoadingStatus(!0),_.get(n).then(l=>{r.orders=Object.assign([],l.data.orders),r.orders.forEach(o=>{let i=Object.values(o.products),h=[],s=[];i.forEach(a=>{h.indexOf(a.product_id)===-1?(h.push(a.product_id),s.push(a)):s.forEach(p=>{p.product_id===a.product_id&&(p.final_total+=a.final_total,p.total+=a.total,p.qty+=a.qty)})}),o.products=s}),r.pagination=Object.assign({},l.data.pagination),r.getIncomeAndDebt(l.data.pagination.total_pages)})},getIncomeAndDebt(e){this.totalIncome=0,this.totalDebt=0;for(let n=1;n<=e;n++){const r=`https://vue-course-api.hexschool.io/api/peterapi/orders?page=${n}`;_.get(r).then(l=>{l.data.orders.forEach(o=>{o.is_paid?this.totalIncome+=o.total:this.totalDebt+=o.total})})}this.$switchLoadingStatus.switchLoadingStatus(!1)},getProducts(){const e="https://vue-course-api.hexschool.io/api/peterapi/products/all",n=this;_.get(e).then(r=>{n.products=r.data.products})},findProductById(e){return this.products.find(l=>{if(e===l.id)return!0})},payOrder(e){this.$router.push(`/admin/customerCheckout/${e}`)},getDate(e){let n=new Date(e*1e3),r=n.getFullYear(),l=n.getMonth()+1,o=n.getDate();return`${r}/${l}/${o}`},currencyFilter(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"NTD"}).format(e)}},created(){this.getOrderList(),this.getProducts()}},m=e=>(x("data-v-1810cf09"),e=e(),D(),e),O={class:"d-flex justify-content-evenly mt-4 text-white"},w={class:"p-4 bg-success rounded-3"},S=m(()=>t("h4",null,"已收金額",-1)),F={class:"p-4 bg-danger rounded-3"},L=m(()=>t("h4",null,"待收帳款",-1)),$={class:"table mt-4 table-hover align-middle"},B=m(()=>t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",{style:{width:"40%"}},"購買項目"),t("th",null,"購買數量"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th")])],-1)),E={key:0,class:"is_paid text-center mb-0"},j={key:1,class:"not_paid text-center mb-0"},A=["onClick"];function C(e,n,r,l,o,i){const h=v("Pagination");return d(),c("div",null,[t("div",O,[t("div",w,[S,t("h1",null,u(i.currencyFilter(o.totalIncome)),1)]),t("div",F,[L,t("h1",null,u(i.currencyFilter(o.totalDebt)),1)])]),t("table",$,[B,t("tbody",null,[(d(!0),c(g,null,y(o.orders,s=>(d(),c("tr",{key:s.id},[t("td",null,u(i.getDate(s.create_at)),1),t("td",null,u(s.user.email),1),t("td",null,[(d(!0),c(g,null,y(s.products,a=>(d(),c("p",{key:a.id},u(i.findProductById(a.product_id).title),1))),128))]),t("td",null,[(d(!0),c(g,null,y(s.products,a=>(d(),c("p",{key:a.id},u(a.qty)+" "+u(i.findProductById(a.product_id).unit),1))),128))]),t("td",null,u(i.currencyFilter(s.total)),1),t("td",null,[s.is_paid?(d(),c("p",E,"已付款")):f("",!0),s.is_paid?f("",!0):(d(),c("p",j,"未付款"))]),t("td",null,[s.is_paid?f("",!0):(d(),c("button",{key:0,class:"btn btn-primary",onClick:a=>i.payOrder(s.id)},"查看付款狀況",8,A))])]))),128))])]),I(h,{pagination:o.pagination,onGetData:i.getOrderList},null,8,["pagination","onGetData"])])}const V=b(P,[["render",C],["__scopeId","data-v-1810cf09"]]);export{V as default};
