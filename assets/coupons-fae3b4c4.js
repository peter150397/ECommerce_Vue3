import{M as h}from"./bootstrap.esm-5f0a523d.js";import{_ as b,a as _,r as C,o as p,c as u,b as e,F as v,k as f,i as y,w as c,v as r,q as w,n as x,t as g,f as D,l as M,p as k,e as T}from"./index-d1494c28.js";import{P as $}from"./Pagination-cd232060.js";const L={data(){return{coupons:[],isNew:!0,tempCoupon:{},pagination:{},tempTimestamp:0}},components:{Pagination:$},methods:{getCouponList(s=1){const t=`https://vue-course-api.hexschool.io/api/peterapi/admin/coupons?page=${s}`,o=this;this.$switchLoadingStatus.switchLoadingStatus(!0),_.get(t).then(l=>{let n=l.data.coupons.sort((d,m)=>d.due_date-m.due_date);o.coupons=n,o.pagination=l.data.pagination,this.$switchLoadingStatus.switchLoadingStatus(!1)})},changeToTimestamp(s){const t=this;let o=new Date(s),l=Math.floor(o.getTime()/1e3);t.tempTimestamp=l},changeToDate(s){let t=new Date(s*1e3),o=t.getFullYear(),l,n;return t.getMonth()+1<10?l=`0${t.getMonth()+1}`:l=t.getMonth()+1,t.getDate()<10?n=`0${t.getDate()}`:n=t.getDate(),`${o}-${l}-${n}`},openModal(s,t){const o=this;o.tempCoupon=Object.assign({},t),s?o.isNew=!0:(o.isNew=!1,o.tempCoupon.due_date=o.changeToDate(o.tempCoupon.due_date)),new h("#couponModal").show()},addCoupon(){const s=this;let t="https://vue-course-api.hexschool.io/api/peterapi/admin/coupon",o="post";s.isNew||(t=`https://vue-course-api.hexschool.io/api/peterapi/admin/coupon/${s.tempCoupon.id}`,o="put"),s.tempCoupon.due_date=s.tempTimestamp,_[o](t,{data:s.tempCoupon}).then(l=>{l.data.success?(this.$mittBus.emit("message:push",{message:l.data.message,status:"success"}),h.getOrCreateInstance("#couponModal").hide()):this.$mittBus.emit("message:push",{message:l.data.message,status:"danger"}),s.getCouponList()})},deleteCoupon(){const s=this,t=`https://vue-course-api.hexschool.io/api/peterapi/admin/coupon/${s.tempCoupon.id}`;_.delete(t).then(o=>{o.data.success?(this.$mittBus.emit("message:push",{message:o.data.message,status:"success"}),h.getOrCreateInstance("#couponModal").hide()):this.$mittBus.emit("message:push",{message:o.data.message,status:"danger"}),s.getCouponList()})},getDate(s){let t=new Date(s*1e3),o,l,n=t.getFullYear();return t.getMonth()+1<10?o=`0${t.getMonth()+1}`:o=t.getMonth()+1,t.getDate()<10?l=`0${t.getDate()}`:l=t.getDate(),`${n}/${o}/${l}`}},created(){this.getCouponList()}},i=s=>(k("data-v-a49ebd2c"),s=s(),T(),s),V={class:"text-right mt-4"},N={class:"table mt-4 table-hover align-middle"},S=i(()=>e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1)),B={key:0},I={key:0,class:"is_enabled"},U={key:1,class:"not_enabled"},F=["onClick"],P={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModal","aria-hidden":"true"},O={class:"modal-dialog modal-md"},G={class:"modal-content border-0"},Y=i(()=>e("div",{class:"modal-header bg-primary text-white"},[e("h5",{class:"modal-title"},[e("span",null,"新增優惠券")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),j={class:"modal-body"},q={class:"row"},z={class:"col d-flex flex-column gap-3"},A=i(()=>e("label",{for:"title"},"標題",-1)),E=i(()=>e("label",{for:"coupon"},"優惠碼",-1)),H={class:"row"},J={class:"form-group col-md-6"},K=i(()=>e("label",{for:"expiryDate"},"到期日",-1)),Q={class:"form-group col-md-6"},R=i(()=>e("label",{for:"discount"},"折扣百分比",-1)),W={class:"form-check"},X=i(()=>e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1)),Z={class:"modal-footer"},ee=i(()=>e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1));function te(s,t,o,l,n,d){const m=C("Pagination");return p(),u("div",null,[e("div",V,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=a=>d.openModal(!0))}," 建立新的優惠券 ")]),e("table",N,[S,e("tbody",null,[(p(!0),u(v,null,f(n.coupons,a=>(p(),u("tr",{key:a.id,class:x({"table-secondary":a.due_date*1e3<new Date})},[e("td",null,g(a.title),1),e("td",null,g(a.percent)+" %",1),e("td",null,[D(g(d.getDate(a.due_date))+" ",1),a.due_date*1e3<new Date?(p(),u("span",B,"(已過期)")):M("",!0)]),e("td",null,[a.is_enabled==1?(p(),u("span",I,"已啟用")):(p(),u("span",U,"未啟用"))]),e("td",null,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:oe=>d.openModal(!1,a)}," 編輯 ",8,F)])],2))),128))])]),y(m,{pagination:n.pagination,onGetData:d.getCouponList},null,8,["pagination","onGetData"]),e("div",P,[e("div",O,[e("div",G,[Y,e("div",j,[e("div",q,[e("div",z,[e("div",null,[A,c(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[1]||(t[1]=a=>n.tempCoupon.title=a),placeholder:"請輸入標題"},null,512),[[r,n.tempCoupon.title]])]),e("div",null,[E,c(e("input",{type:"text",class:"form-control",id:"coupon","onUpdate:modelValue":t[2]||(t[2]=a=>n.tempCoupon.code=a),placeholder:"請輸入優惠碼"},null,512),[[r,n.tempCoupon.code]])]),e("div",H,[e("div",J,[K,c(e("input",{type:"date",class:"form-control",id:"expiryDate","onUpdate:modelValue":t[3]||(t[3]=a=>n.tempCoupon.due_date=a),onChange:t[4]||(t[4]=a=>d.changeToTimestamp(n.tempCoupon.due_date)),placeholder:"請輸入日期"},null,544),[[r,n.tempCoupon.due_date]])]),e("div",Q,[R,c(e("input",{type:"number",class:"form-control",id:"discount","onUpdate:modelValue":t[5]||(t[5]=a=>n.tempCoupon.percent=a),placeholder:"請輸入折扣"},null,512),[[r,n.tempCoupon.percent]])])]),e("div",null,[e("div",W,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=a=>n.tempCoupon.is_enabled=a),"true-value":1,"false-value":0,id:"is_enabled"},null,512),[[w,n.tempCoupon.is_enabled]]),X])])])])]),e("div",Z,[ee,e("button",{type:"button",class:"btn btn-primary",onClick:t[7]||(t[7]=(...a)=>d.addCoupon&&d.addCoupon(...a))}," 確認 "),e("button",{type:"button",class:"btn btn-danger",onClick:t[8]||(t[8]=(...a)=>d.deleteCoupon&&d.deleteCoupon(...a))}," 刪除 ")])])])])])}const le=b(L,[["render",te],["__scopeId","data-v-a49ebd2c"]]);export{le as default};
