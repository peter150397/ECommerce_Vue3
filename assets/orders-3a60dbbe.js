import{_ as f,a as _,r as v,o as r,c as i,b as t,t as u,F as g,k as m,i as x,l as b,p as D,e as k}from"./index-d1494c28.js";import{P as I}from"./Pagination-cd232060.js";const O={data(){return{orders:[],products:[],pagination:{},totalIncome:0,totalDebt:0}},components:{Pagination:I},methods:{getOrderList(e=1){const n=`https://vue-course-api.hexschool.io/api/peterapi/orders?page=${e}`,l=this;this.$switchLoadingStatus.switchLoadingStatus(!0),_.get(n).then(c=>{l.orders=Object.assign([],c.data.orders),l.orders.forEach(o=>{let d=Object.values(o.products),p=[],a=[];d.forEach(s=>{p.indexOf(s.product_id)===-1?(p.push(s.product_id),a.push(s)):a.forEach(h=>{h.product_id===s.product_id&&(h.final_total+=s.final_total,h.total+=s.total,h.qty+=s.qty)})}),o.products=a}),l.pagination=Object.assign({},c.data.pagination),l.getIncomeAndDebt(c.data.pagination.total_pages)})},getIncomeAndDebt(e){this.totalIncome=0,this.totalDebt=0;for(let n=1;n<=e;n++){const l=`https://vue-course-api.hexschool.io/api/peterapi/orders?page=${n}`;_.get(l).then(c=>{c.data.orders.forEach(o=>{o.is_paid?this.totalIncome+=o.total:this.totalDebt+=o.total})})}this.$switchLoadingStatus.switchLoadingStatus(!1)},getProducts(){const e="https://vue-course-api.hexschool.io/api/peterapi/products/all",n=this;_.get(e).then(l=>{n.products=l.data.products})},payOrder(e){this.$router.push(`/admin/customerCheckout/${e}`)},getDate(e){let n=new Date(e*1e3),l=n.getFullYear(),c=n.getMonth()+1,o=n.getDate();return`${l}/${c}/${o}`},currencyFilter(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"NTD",maximumFractionDigits:0}).format(e)}},created(){this.getOrderList(),this.getProducts()}},y=e=>(D("data-v-d98c3bb7"),e=e(),k(),e),$={class:"d-flex justify-content-evenly mt-4 text-white"},F={class:"p-4 bg-success rounded-3"},S=y(()=>t("h4",null,"已收金額",-1)),w={class:"p-4 bg-danger rounded-3"},L=y(()=>t("h4",null,"待收帳款",-1)),E={class:"table mt-4 table-hover align-middle fs-6"},P=y(()=>t("thead",null,[t("tr",null,[t("th",{class:"align-middle"},[t("p",{class:"m-0"},"購買時間")]),t("th",{class:"d-md-table-cell d-none align-middle"},[t("p",{class:"m-0"},"Email")]),t("th",{class:"align-middle"},[t("p",{class:"m-0"},"購買項目")]),t("th",{class:"align-middle"},[t("p",{class:"m-0"},"購買數量")]),t("th",{class:"align-middle"},[t("p",{class:"m-0"},"應付金額")]),t("th",{class:"align-middle"},[t("p",{class:"m-0"},"是否付款")]),t("th")])],-1)),j={class:"text-break"},A={class:"d-md-table-cell d-none"},C={class:"text-break"},N={key:0,class:"is_paid text-center mb-0"},q={key:1,class:"not_paid text-center mb-0"},B=["onClick"];function V(e,n,l,c,o,d){const p=v("Pagination");return r(),i("div",null,[t("div",$,[t("div",F,[S,t("h1",null,u(d.currencyFilter(o.totalIncome)),1)]),t("div",w,[L,t("h1",null,u(d.currencyFilter(o.totalDebt)),1)])]),t("table",E,[P,t("tbody",null,[(r(!0),i(g,null,m(o.orders,a=>(r(),i("tr",{key:a.id},[t("td",j,[t("p",null,u(d.getDate(a.create_at)),1)]),t("td",A,[t("p",null,u(a.user.email),1)]),t("td",null,[(r(!0),i(g,null,m(a.products,s=>(r(),i("p",{key:s.id},u(s.product.title),1))),128))]),t("td",null,[(r(!0),i(g,null,m(a.products,s=>(r(),i("p",{key:s.id},u(s.qty)+" "+u(s.product.unit),1))),128))]),t("td",C,[t("p",null,u(d.currencyFilter(a.total)),1)]),t("td",null,[a.is_paid?(r(),i("p",N,"已付款")):b("",!0),a.is_paid?b("",!0):(r(),i("p",q,"未付款"))]),t("td",null,[a.is_paid?b("",!0):(r(),i("button",{key:0,class:"btn btn-primary text-center",onClick:s=>d.payOrder(a.id)},"付款狀況",8,B))])]))),128))])]),x(p,{pagination:o.pagination,onGetData:d.getOrderList},null,8,["pagination","onGetData"])])}const M=f(O,[["render",V],["__scopeId","data-v-d98c3bb7"]]);export{M as default};
