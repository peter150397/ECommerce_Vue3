import{a as p,aQ as m,o as i,c as l,b as t,b2 as c,F as h,aO as _,L as b,z as g,p as v,e as D}from"./index-d4bc659e.js";import{P as I}from"./Pagination-be65b6c6.js";import{_ as x}from"./plugin-vueexport-helper-c27b6911.js";const k={data(){return{orders:[],products:[],pagination:{},totalIncome:0,totalDebt:0}},components:{Pagination:I},methods:{getOrderList(e=1){const a=`https://vue-course-api.hexschool.io/api/peterapi/orders?page=${e}`,s=this;this.$switchLoadingStatus.switchLoadingStatus(!0),p.get(a).then(n=>{s.orders=Object.assign([],n.data.orders),s.pagination=Object.assign({},n.data.pagination),s.getIncomeAndDebt(n.data.pagination.total_pages)})},getIncomeAndDebt(e){this.totalIncome=0,this.totalDebt=0;for(let a=1;a<=e;a++){const s=`https://vue-course-api.hexschool.io/api/peterapi/orders?page=${a}`;p.get(s).then(n=>{n.data.orders.forEach(o=>{o.is_paid?this.totalIncome+=o.total:this.totalDebt+=o.total})})}this.$switchLoadingStatus.switchLoadingStatus(!1)},getProducts(){const e="https://vue-course-api.hexschool.io/api/peterapi/products/all",a=this;p.get(e).then(s=>{a.products=s.data.products})},findProductById(e){return this.products.find(n=>{if(e===n.id)return!0})},payOrder(e){this.$router.push(`/admin/customerCheckout/${e}`)},getDate(e){let a=new Date(e*1e3),s=a.getFullYear(),n=a.getMonth()+1,o=a.getDate();return`${s}/${n}/${o}`},currencyFilter(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"NTD"}).format(e)}},created(){this.getOrderList(),this.getProducts()}},y=e=>(v("data-v-fa8fa4be"),e=e(),D(),e),P={class:"d-flex justify-content-evenly mt-4 text-white"},w={class:"p-4 bg-success rounded-3"},L=y(()=>t("h4",null,"已收金額",-1)),S={class:"p-4 bg-danger rounded-3"},F=y(()=>t("h4",null,"待收帳款",-1)),O={class:"table mt-4 table-hover align-middle"},$=y(()=>t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",{style:{width:"40%"}},"購買項目"),t("th",null,"購買數量"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th")])],-1)),B={class:"text-right"},C={key:0,class:"is_paid"},N={key:1,class:"not_paid"},j=["onClick"];function E(e,a,s,n,o,d){const f=m("Pagination");return i(),l("div",null,[t("div",P,[t("div",w,[L,t("h1",null,c(d.currencyFilter(o.totalIncome)),1)]),t("div",S,[F,t("h1",null,c(d.currencyFilter(o.totalDebt)),1)])]),t("table",O,[$,t("tbody",null,[(i(!0),l(h,null,_(o.orders,r=>(i(),l("tr",{key:r.id},[t("td",null,c(d.getDate(r.create_at)),1),t("td",null,c(r.user.email),1),t("td",null,[(i(!0),l(h,null,_(r.products,u=>(i(),l("p",{key:u.id},c(d.findProductById(u.product_id).title),1))),128))]),t("td",null,[(i(!0),l(h,null,_(r.products,u=>(i(),l("p",{key:u.id},c(u.qty)+" "+c(d.findProductById(u.product_id).unit),1))),128))]),t("td",null,[t("p",B,c(d.currencyFilter(r.total)),1)]),t("td",null,[r.is_paid?(i(),l("span",C,"已付款")):g("",!0),r.is_paid?g("",!0):(i(),l("span",N,"未付款"))]),t("td",null,[r.is_paid?g("",!0):(i(),l("button",{key:0,class:"btn btn-primary",onClick:u=>d.payOrder(r.id)},"查看付款狀況",8,j))])]))),128))])]),b(f,{pagination:o.pagination,onGetData:d.getOrderList},null,8,["pagination","onGetData"])])}const q=x(k,[["render",E],["__scopeId","data-v-fa8fa4be"]]);export{q as default};
