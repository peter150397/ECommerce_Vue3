import{_ as f,a as _,r as v,o as l,c as i,b as t,t as u,F as g,k as y,i as x,l as b,p as D,e as k}from"./index-e44b7b7b.js";import{P as I}from"./Pagination-e1172c76.js";const O={data(){return{orders:[],products:[],pagination:{},totalIncome:0,totalDebt:0}},components:{Pagination:I},methods:{getOrderList(e=1){const n=`https://vue-course-api.hexschool.io/api/peterapi/orders?page=${e}`,r=this;this.$switchLoadingStatus.switchLoadingStatus(!0),_.get(n).then(c=>{r.orders=Object.assign([],c.data.orders),r.orders.forEach(o=>{let d=Object.values(o.products),p=[],s=[];d.forEach(a=>{p.indexOf(a.product_id)===-1?(p.push(a.product_id),s.push(a)):s.forEach(h=>{h.product_id===a.product_id&&(h.final_total+=a.final_total,h.total+=a.total,h.qty+=a.qty)})}),o.products=s}),r.pagination=Object.assign({},c.data.pagination),r.getIncomeAndDebt(c.data.pagination.total_pages)})},getIncomeAndDebt(e){this.totalIncome=0,this.totalDebt=0;for(let n=1;n<=e;n++){const r=`https://vue-course-api.hexschool.io/api/peterapi/orders?page=${n}`;_.get(r).then(c=>{c.data.orders.forEach(o=>{o.is_paid?this.totalIncome+=o.total:this.totalDebt+=o.total})})}this.$switchLoadingStatus.switchLoadingStatus(!1)},getProducts(){const e="https://vue-course-api.hexschool.io/api/peterapi/products/all",n=this;_.get(e).then(r=>{n.products=r.data.products})},payOrder(e){this.$router.push(`/admin/customerCheckout/${e}`)},getDate(e){let n=new Date(e*1e3),r=n.getFullYear(),c=n.getMonth()+1,o=n.getDate();return`${r}/${c}/${o}`},currencyFilter(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"NTD"}).format(e)}},created(){this.getOrderList(),this.getProducts()}},m=e=>(D("data-v-e987abb1"),e=e(),k(),e),$={class:"d-flex justify-content-evenly mt-4 text-white"},w={class:"p-4 bg-success rounded-3"},S=m(()=>t("h4",null,"已收金額",-1)),F={class:"p-4 bg-danger rounded-3"},L=m(()=>t("h4",null,"待收帳款",-1)),E={class:"table mt-4 table-hover align-middle"},P=m(()=>t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",{style:{width:"40%"}},"購買項目"),t("th",null,"購買數量"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th")])],-1)),j={key:0,class:"is_paid text-center mb-0"},A={key:1,class:"not_paid text-center mb-0"},C=["onClick"];function N(e,n,r,c,o,d){const p=v("Pagination");return l(),i("div",null,[t("div",$,[t("div",w,[S,t("h1",null,u(d.currencyFilter(o.totalIncome)),1)]),t("div",F,[L,t("h1",null,u(d.currencyFilter(o.totalDebt)),1)])]),t("table",E,[P,t("tbody",null,[(l(!0),i(g,null,y(o.orders,s=>(l(),i("tr",{key:s.id},[t("td",null,u(d.getDate(s.create_at)),1),t("td",null,u(s.user.email),1),t("td",null,[(l(!0),i(g,null,y(s.products,a=>(l(),i("p",{key:a.id},u(a.product.title),1))),128))]),t("td",null,[(l(!0),i(g,null,y(s.products,a=>(l(),i("p",{key:a.id},u(a.qty)+" "+u(a.product.unit),1))),128))]),t("td",null,u(d.currencyFilter(s.total)),1),t("td",null,[s.is_paid?(l(),i("p",j,"已付款")):b("",!0),s.is_paid?b("",!0):(l(),i("p",A,"未付款"))]),t("td",null,[s.is_paid?b("",!0):(l(),i("button",{key:0,class:"btn btn-primary",onClick:a=>d.payOrder(s.id)},"查看付款狀況",8,C))])]))),128))])]),x(p,{pagination:o.pagination,onGetData:d.getOrderList},null,8,["pagination","onGetData"])])}const V=f(O,[["render",N],["__scopeId","data-v-e987abb1"]]);export{V as default};
