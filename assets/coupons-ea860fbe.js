import"./jquery-0488b3e6.js";import{M as m}from"./bootstrap.esm-5f0a523d.js";import{a as h,r as b,o as p,c as u,g,b as e,F as f,i as y,w as c,v as r,j as x,t as _,p as M,e as w}from"./index-527a84c7.js";import{P as D,L as k}from"./Pagination-ab02d354.js";import{_ as L}from"./plugin-vueexport-helper-c27b6911.js";const T={data(){return{coupons:[],isNew:!0,tempCoupon:{},pagination:{},tempTimestamp:0,isLoading:!1}},components:{Pagination:D,Loading:k},methods:{getCouponList(o=1){const t=`https://vue-course-api.hexschool.io/api/peterapi/admin/coupons?page=${o}`,n=this;n.isLoading=!0,h.get(t).then(a=>{n.coupons=a.data.coupons,n.pagination=a.data.pagination,n.isLoading=!1})},changeToTimestamp(o){const t=this;let n=new Date(o),a=Math.floor(n.getTime()/1e3);t.tempTimestamp=a},changeToDate(o){let t=new Date(o*1e3),n=t.getFullYear(),a=t.getMonth()+1;t.getMonth()+1<10&&(a=`0${t.getMonth()+1}`);let l=t.getDate();return t.getDate()<10&&(l=`0${t.getDate()}`),`${n}-${a}-${l}`},openModal(o,t){const n=this;n.tempCoupon=Object.assign({},t),o?n.isNew=!0:(n.isNew=!1,n.tempCoupon.due_date=n.changeToDate(n.tempCoupon.due_date)),new m("#couponModal").show()},addCoupon(){const o=this;let t="https://vue-course-api.hexschool.io/api/peterapi/admin/coupon",n="post";o.isNew||(t=`https://vue-course-api.hexschool.io/api/peterapi/admin/coupon/${o.tempCoupon.id}`,n="put"),o.tempCoupon.due_date=o.tempTimestamp,h[n](t,{data:o.tempCoupon}).then(a=>{m.getOrCreateInstance("#couponModal").hide(),o.getCouponList()})},deleteCoupon(){const o=this,t=`https://vue-course-api.hexschool.io/api/peterapi/admin/coupon/${o.tempCoupon.id}`;h.delete(t).then(n=>{m.getOrCreateInstance("#couponModal").hide(),o.getCouponList()})},getDate(o){let t=new Date(o*1e3),n=t.getFullYear(),a=t.getMonth()+1,l=t.getDate();return`${n}/${a}/${l}`}},created(){this.getCouponList()}},d=o=>(M("data-v-e206c0ab"),o=o(),w(),o),V={class:"text-right mt-4"},I={class:"table mt-4 table-hover align-middle"},N=d(()=>e("thead",null,[e("tr",null,[e("th",{style:{width:"40%"}},"名稱"),e("th",null,"折扣"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1)),U={key:0,class:"is_enabled"},F={key:1,class:"not_enabled"},P=["onClick"],S={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModal","aria-hidden":"true"},B={class:"modal-dialog modal-md"},O={class:"modal-content border-0"},$=d(()=>e("div",{class:"modal-header bg-primary text-white"},[e("h5",{class:"modal-title"},[e("span",null,"新增優惠券")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),j={class:"modal-body"},G={class:"row"},Y={class:"col d-flex flex-column gap-3"},E=d(()=>e("label",{for:"title"},"標題",-1)),q=d(()=>e("label",{for:"coupon"},"優惠碼",-1)),z={class:"row"},A={class:"form-group col-md-6"},H=d(()=>e("label",{for:"expiryDate"},"到期日",-1)),J={class:"form-group col-md-6"},K=d(()=>e("label",{for:"discount"},"折扣百分比",-1)),Q={class:"form-check"},R=d(()=>e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1)),W={class:"modal-footer"},X=d(()=>e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1));function Z(o,t,n,a,l,i){const v=b("loading"),C=b("Pagination");return p(),u("div",null,[g(v,{active:l.isLoading},null,8,["active"]),e("div",V,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=s=>i.openModal(!0))}," 建立新的優惠券 ")]),e("table",I,[N,e("tbody",null,[(p(!0),u(f,null,y(l.coupons,s=>(p(),u("tr",{key:s.id},[e("td",null,_(s.title),1),e("td",null,_(s.percent)+" %",1),e("td",null,_(i.getDate(s.due_date)),1),e("td",null,[s.is_enabled==1?(p(),u("span",U,"已啟用")):(p(),u("span",F,"未啟用"))]),e("td",null,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:ee=>i.openModal(!1,s)}," 編輯 ",8,P)])]))),128))])]),g(C,{pagination:l.pagination,onGetData:i.getCouponList},null,8,["pagination","onGetData"]),e("div",S,[e("div",B,[e("div",O,[$,e("div",j,[e("div",G,[e("div",Y,[e("div",null,[E,c(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[1]||(t[1]=s=>l.tempCoupon.title=s),placeholder:"請輸入標題"},null,512),[[r,l.tempCoupon.title]])]),e("div",null,[q,c(e("input",{type:"text",class:"form-control",id:"coupon","onUpdate:modelValue":t[2]||(t[2]=s=>l.tempCoupon.code=s),placeholder:"請輸入優惠碼"},null,512),[[r,l.tempCoupon.code]])]),e("div",z,[e("div",A,[H,c(e("input",{type:"date",class:"form-control",id:"expiryDate","onUpdate:modelValue":t[3]||(t[3]=s=>l.tempCoupon.due_date=s),onChange:t[4]||(t[4]=s=>i.changeToTimestamp(l.tempCoupon.due_date)),placeholder:"請輸入日期"},null,544),[[r,l.tempCoupon.due_date]])]),e("div",J,[K,c(e("input",{type:"number",class:"form-control",id:"discount","onUpdate:modelValue":t[5]||(t[5]=s=>l.tempCoupon.percent=s),placeholder:"請輸入折扣"},null,512),[[r,l.tempCoupon.percent]])])]),e("div",null,[e("div",Q,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=s=>l.tempCoupon.is_enabled=s),"true-value":1,"false-value":0,id:"is_enabled"},null,512),[[x,l.tempCoupon.is_enabled]]),R])])])])]),e("div",W,[X,e("button",{type:"button",class:"btn btn-primary",onClick:t[7]||(t[7]=(...s)=>i.addCoupon&&i.addCoupon(...s))}," 確認 "),e("button",{type:"button",class:"btn btn-danger",onClick:t[8]||(t[8]=(...s)=>i.deleteCoupon&&i.deleteCoupon(...s))}," 刪除 ")])])])])])}const ae=L(T,[["render",Z],["__scopeId","data-v-e206c0ab"]]);export{ae as default};
