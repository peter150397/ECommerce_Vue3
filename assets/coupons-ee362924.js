import{M as h}from"./bootstrap.esm-5f0a523d.js";import{_ as b,a as _,r as C,o as p,c as u,b as e,F as f,k as v,i as y,w as c,v as r,q as w,n as x,t as g,f as D,l as M,p as k,e as T}from"./index-11adf39a.js";import{P as L}from"./Pagination-b16c05b0.js";const V={data(){return{coupons:[],isNew:!0,tempCoupon:{},pagination:{},tempTimestamp:0}},components:{Pagination:L},methods:{getCouponList(o=1){const t=`https://vue-course-api.hexschool.io/api/peterapi/admin/coupons?page=${o}`,s=this;this.$switchLoadingStatus.switchLoadingStatus(!0),_.get(t).then(l=>{let a=l.data.coupons.sort((d,m)=>d.due_date-m.due_date);s.coupons=a,s.pagination=l.data.pagination,this.$switchLoadingStatus.switchLoadingStatus(!1)})},changeToTimestamp(o){const t=this;let s=new Date(o),l=Math.floor(s.getTime()/1e3);t.tempTimestamp=l},changeToDate(o){let t=new Date(o*1e3),s=t.getFullYear(),l;t.getMonth()+1<10?l=`0${t.getMonth()+1}`:l=t.getMonth()+1;let a=t.getDate();return t.getDate()<10&&(a=`0${t.getDate()}`),`${s}-${l}-${a}`},openModal(o,t){const s=this;s.tempCoupon=Object.assign({},t),o?s.isNew=!0:(s.isNew=!1,s.tempCoupon.due_date=s.changeToDate(s.tempCoupon.due_date)),new h("#couponModal").show()},addCoupon(){const o=this;let t="https://vue-course-api.hexschool.io/api/peterapi/admin/coupon",s="post";o.isNew||(t=`https://vue-course-api.hexschool.io/api/peterapi/admin/coupon/${o.tempCoupon.id}`,s="put"),o.tempCoupon.due_date=o.tempTimestamp,_[s](t,{data:o.tempCoupon}).then(l=>{h.getOrCreateInstance("#couponModal").hide(),o.getCouponList()})},deleteCoupon(){const o=this,t=`https://vue-course-api.hexschool.io/api/peterapi/admin/coupon/${o.tempCoupon.id}`;_.delete(t).then(s=>{h.getOrCreateInstance("#couponModal").hide(),o.getCouponList()})},getDate(o){let t=new Date(o*1e3),s,l,a=t.getFullYear();return t.getMonth()+1<10?s=`0${t.getMonth()+1}`:s=t.getMonth()+1,t.getDate()<10?l=`0${t.getDate()<10}`:l=t.getDate(),`${a}/${s}/${l}`}},created(){this.getCouponList()}},i=o=>(k("data-v-c410f676"),o=o(),T(),o),N={class:"text-right mt-4"},S={class:"table mt-4 table-hover align-middle"},$=i(()=>e("thead",null,[e("tr",null,[e("th",{style:{width:"40%"}},"名稱"),e("th",null,"折扣"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1)),I={key:0},U={key:0,class:"is_enabled"},F={key:1,class:"not_enabled"},P=["onClick"],B={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModal","aria-hidden":"true"},O={class:"modal-dialog modal-md"},G={class:"modal-content border-0"},Y=i(()=>e("div",{class:"modal-header bg-primary text-white"},[e("h5",{class:"modal-title"},[e("span",null,"新增優惠券")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),j={class:"modal-body"},q={class:"row"},z={class:"col d-flex flex-column gap-3"},A=i(()=>e("label",{for:"title"},"標題",-1)),E=i(()=>e("label",{for:"coupon"},"優惠碼",-1)),H={class:"row"},J={class:"form-group col-md-6"},K=i(()=>e("label",{for:"expiryDate"},"到期日",-1)),Q={class:"form-group col-md-6"},R=i(()=>e("label",{for:"discount"},"折扣百分比",-1)),W={class:"form-check"},X=i(()=>e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1)),Z={class:"modal-footer"},ee=i(()=>e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1));function te(o,t,s,l,a,d){const m=C("Pagination");return p(),u("div",null,[e("div",N,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=n=>d.openModal(!0))}," 建立新的優惠券 ")]),e("table",S,[$,e("tbody",null,[(p(!0),u(f,null,v(a.coupons,n=>(p(),u("tr",{key:n.id,class:x({"table-secondary":n.due_date*1e3<new Date})},[e("td",null,g(n.title),1),e("td",null,g(n.percent)+" %",1),e("td",null,[D(g(d.getDate(n.due_date))+" ",1),n.due_date*1e3<new Date?(p(),u("span",I,"(已過期)")):M("",!0)]),e("td",null,[n.is_enabled==1?(p(),u("span",U,"已啟用")):(p(),u("span",F,"未啟用"))]),e("td",null,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:oe=>d.openModal(!1,n)}," 編輯 ",8,P)])],2))),128))])]),y(m,{pagination:a.pagination,onGetData:d.getCouponList},null,8,["pagination","onGetData"]),e("div",B,[e("div",O,[e("div",G,[Y,e("div",j,[e("div",q,[e("div",z,[e("div",null,[A,c(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[1]||(t[1]=n=>a.tempCoupon.title=n),placeholder:"請輸入標題"},null,512),[[r,a.tempCoupon.title]])]),e("div",null,[E,c(e("input",{type:"text",class:"form-control",id:"coupon","onUpdate:modelValue":t[2]||(t[2]=n=>a.tempCoupon.code=n),placeholder:"請輸入優惠碼"},null,512),[[r,a.tempCoupon.code]])]),e("div",H,[e("div",J,[K,c(e("input",{type:"date",class:"form-control",id:"expiryDate","onUpdate:modelValue":t[3]||(t[3]=n=>a.tempCoupon.due_date=n),onChange:t[4]||(t[4]=n=>d.changeToTimestamp(a.tempCoupon.due_date)),placeholder:"請輸入日期"},null,544),[[r,a.tempCoupon.due_date]])]),e("div",Q,[R,c(e("input",{type:"number",class:"form-control",id:"discount","onUpdate:modelValue":t[5]||(t[5]=n=>a.tempCoupon.percent=n),placeholder:"請輸入折扣"},null,512),[[r,a.tempCoupon.percent]])])]),e("div",null,[e("div",W,[c(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=n=>a.tempCoupon.is_enabled=n),"true-value":1,"false-value":0,id:"is_enabled"},null,512),[[w,a.tempCoupon.is_enabled]]),X])])])])]),e("div",Z,[ee,e("button",{type:"button",class:"btn btn-primary",onClick:t[7]||(t[7]=(...n)=>d.addCoupon&&d.addCoupon(...n))}," 確認 "),e("button",{type:"button",class:"btn btn-danger",onClick:t[8]||(t[8]=(...n)=>d.deleteCoupon&&d.deleteCoupon(...n))}," 刪除 ")])])])])])}const le=b(V,[["render",te],["__scopeId","data-v-c410f676"]]);export{le as default};
