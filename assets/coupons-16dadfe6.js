import{M as m}from"./bootstrap.esm-5f0a523d.js";import{a as h,aQ as g,o as p,c as u,b as t,F as v,aO as C,L as f,w as c,v as r,bj as y,b2 as _,p as w,e as x}from"./index-d4bc659e.js";import{P as M}from"./Pagination-be65b6c6.js";import{_ as D}from"./plugin-vueexport-helper-c27b6911.js";const k={data(){return{coupons:[],isNew:!0,tempCoupon:{},pagination:{},tempTimestamp:0}},components:{Pagination:M},methods:{getCouponList(o=1){const e=`https://vue-course-api.hexschool.io/api/peterapi/admin/coupons?page=${o}`,s=this;this.$switchLoadingStatus.switchLoadingStatus(!0),h.get(e).then(l=>{s.coupons=l.data.coupons,s.pagination=l.data.pagination,this.$switchLoadingStatus.switchLoadingStatus(!1)})},changeToTimestamp(o){const e=this;let s=new Date(o),l=Math.floor(s.getTime()/1e3);e.tempTimestamp=l},changeToDate(o){let e=new Date(o*1e3),s=e.getFullYear(),l=e.getMonth()+1;e.getMonth()+1<10&&(l=`0${e.getMonth()+1}`);let a=e.getDate();return e.getDate()<10&&(a=`0${e.getDate()}`),`${s}-${l}-${a}`},openModal(o,e){const s=this;s.tempCoupon=Object.assign({},e),o?s.isNew=!0:(s.isNew=!1,s.tempCoupon.due_date=s.changeToDate(s.tempCoupon.due_date)),new m("#couponModal").show()},addCoupon(){const o=this;let e="https://vue-course-api.hexschool.io/api/peterapi/admin/coupon",s="post";o.isNew||(e=`https://vue-course-api.hexschool.io/api/peterapi/admin/coupon/${o.tempCoupon.id}`,s="put"),o.tempCoupon.due_date=o.tempTimestamp,h[s](e,{data:o.tempCoupon}).then(l=>{m.getOrCreateInstance("#couponModal").hide(),o.getCouponList()})},deleteCoupon(){const o=this,e=`https://vue-course-api.hexschool.io/api/peterapi/admin/coupon/${o.tempCoupon.id}`;h.delete(e).then(s=>{m.getOrCreateInstance("#couponModal").hide(),o.getCouponList()})},getDate(o){let e=new Date(o*1e3),s=e.getFullYear(),l=e.getMonth()+1,a=e.getDate();return`${s}/${l}/${a}`}},created(){this.getCouponList()}},d=o=>(w("data-v-57bd65a6"),o=o(),x(),o),L={class:"text-right mt-4"},T={class:"table mt-4 table-hover align-middle"},S=d(()=>t("thead",null,[t("tr",null,[t("th",{style:{width:"40%"}},"名稱"),t("th",null,"折扣"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1)),V={key:0,class:"is_enabled"},I={key:1,class:"not_enabled"},N=["onClick"],$={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModal","aria-hidden":"true"},U={class:"modal-dialog modal-md"},F={class:"modal-content border-0"},O=d(()=>t("div",{class:"modal-header bg-primary text-white"},[t("h5",{class:"modal-title"},[t("span",null,"新增優惠券")]),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),P={class:"modal-body"},B={class:"row"},j={class:"col d-flex flex-column gap-3"},G=d(()=>t("label",{for:"title"},"標題",-1)),Y=d(()=>t("label",{for:"coupon"},"優惠碼",-1)),E={class:"row"},Q={class:"form-group col-md-6"},q=d(()=>t("label",{for:"expiryDate"},"到期日",-1)),z={class:"form-group col-md-6"},A=d(()=>t("label",{for:"discount"},"折扣百分比",-1)),H={class:"form-check"},J=d(()=>t("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1)),K={class:"modal-footer"},R=d(()=>t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1));function W(o,e,s,l,a,i){const b=g("Pagination");return p(),u("div",null,[t("div",L,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=n=>i.openModal(!0))}," 建立新的優惠券 ")]),t("table",T,[S,t("tbody",null,[(p(!0),u(v,null,C(a.coupons,n=>(p(),u("tr",{key:n.id},[t("td",null,_(n.title),1),t("td",null,_(n.percent)+" %",1),t("td",null,_(i.getDate(n.due_date)),1),t("td",null,[n.is_enabled==1?(p(),u("span",V,"已啟用")):(p(),u("span",I,"未啟用"))]),t("td",null,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:X=>i.openModal(!1,n)}," 編輯 ",8,N)])]))),128))])]),f(b,{pagination:a.pagination,onGetData:i.getCouponList},null,8,["pagination","onGetData"]),t("div",$,[t("div",U,[t("div",F,[O,t("div",P,[t("div",B,[t("div",j,[t("div",null,[G,c(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[1]||(e[1]=n=>a.tempCoupon.title=n),placeholder:"請輸入標題"},null,512),[[r,a.tempCoupon.title]])]),t("div",null,[Y,c(t("input",{type:"text",class:"form-control",id:"coupon","onUpdate:modelValue":e[2]||(e[2]=n=>a.tempCoupon.code=n),placeholder:"請輸入優惠碼"},null,512),[[r,a.tempCoupon.code]])]),t("div",E,[t("div",Q,[q,c(t("input",{type:"date",class:"form-control",id:"expiryDate","onUpdate:modelValue":e[3]||(e[3]=n=>a.tempCoupon.due_date=n),onChange:e[4]||(e[4]=n=>i.changeToTimestamp(a.tempCoupon.due_date)),placeholder:"請輸入日期"},null,544),[[r,a.tempCoupon.due_date]])]),t("div",z,[A,c(t("input",{type:"number",class:"form-control",id:"discount","onUpdate:modelValue":e[5]||(e[5]=n=>a.tempCoupon.percent=n),placeholder:"請輸入折扣"},null,512),[[r,a.tempCoupon.percent]])])]),t("div",null,[t("div",H,[c(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=n=>a.tempCoupon.is_enabled=n),"true-value":1,"false-value":0,id:"is_enabled"},null,512),[[y,a.tempCoupon.is_enabled]]),J])])])])]),t("div",K,[R,t("button",{type:"button",class:"btn btn-primary",onClick:e[7]||(e[7]=(...n)=>i.addCoupon&&i.addCoupon(...n))}," 確認 "),t("button",{type:"button",class:"btn btn-danger",onClick:e[8]||(e[8]=(...n)=>i.deleteCoupon&&i.deleteCoupon(...n))}," 刪除 ")])])])])])}const nt=D(k,[["render",W],["__scopeId","data-v-57bd65a6"]]);export{nt as default};
