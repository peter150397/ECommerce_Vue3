import{_ as m,a as p,r as b,o as i,c as l,b as t,t as c,F as h,k as _,i as v,l as g,p as D,e as I}from"./index-4f153bf4.js";import{P as k}from"./Pagination-1d4b510f.js";const x={data(){return{orders:[],products:[],pagination:{},totalIncome:0,totalDebt:0}},components:{Pagination:k},methods:{getOrderList(e=1){const s=`https://vue-course-api.hexschool.io/api/peterapi/orders?page=${e}`,a=this;this.$switchLoadingStatus.switchLoadingStatus(!0),p.get(s).then(n=>{a.orders=Object.assign([],n.data.orders),a.pagination=Object.assign({},n.data.pagination),a.getIncomeAndDebt(n.data.pagination.total_pages)})},getIncomeAndDebt(e){this.totalIncome=0,this.totalDebt=0;for(let s=1;s<=e;s++){const a=`https://vue-course-api.hexschool.io/api/peterapi/orders?page=${s}`;p.get(a).then(n=>{n.data.orders.forEach(o=>{o.is_paid?this.totalIncome+=o.total:this.totalDebt+=o.total})})}this.$switchLoadingStatus.switchLoadingStatus(!1)},getProducts(){const e="https://vue-course-api.hexschool.io/api/peterapi/products/all",s=this;p.get(e).then(a=>{s.products=a.data.products})},findProductById(e){return this.products.find(n=>{if(e===n.id)return!0})},payOrder(e){this.$router.push(`/admin/customerCheckout/${e}`)},getDate(e){let s=new Date(e*1e3),a=s.getFullYear(),n=s.getMonth()+1,o=s.getDate();return`${a}/${n}/${o}`},currencyFilter(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"NTD"}).format(e)}},created(){this.getOrderList(),this.getProducts()}},y=e=>(D("data-v-370b40ef"),e=e(),I(),e),P={class:"d-flex justify-content-evenly mt-4 text-white"},w={class:"p-4 bg-success rounded-3"},S=y(()=>t("h4",null,"已收金額",-1)),F={class:"p-4 bg-danger rounded-3"},L=y(()=>t("h4",null,"待收帳款",-1)),$={class:"table mt-4 table-hover align-middle"},O=y(()=>t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",{style:{width:"40%"}},"購買項目"),t("th",null,"購買數量"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th")])],-1)),B={class:"text-right"},C={key:0,class:"is_paid"},N={key:1,class:"not_paid"},j=["onClick"];function E(e,s,a,n,o,d){const f=b("Pagination");return i(),l("div",null,[t("div",P,[t("div",w,[S,t("h1",null,c(d.currencyFilter(o.totalIncome)),1)]),t("div",F,[L,t("h1",null,c(d.currencyFilter(o.totalDebt)),1)])]),t("table",$,[O,t("tbody",null,[(i(!0),l(h,null,_(o.orders,r=>(i(),l("tr",{key:r.id},[t("td",null,c(d.getDate(r.create_at)),1),t("td",null,c(r.user.email),1),t("td",null,[(i(!0),l(h,null,_(r.products,u=>(i(),l("p",{key:u.id},c(d.findProductById(u.product_id).title),1))),128))]),t("td",null,[(i(!0),l(h,null,_(r.products,u=>(i(),l("p",{key:u.id},c(u.qty)+" "+c(d.findProductById(u.product_id).unit),1))),128))]),t("td",null,[t("p",B,c(d.currencyFilter(r.total)),1)]),t("td",null,[r.is_paid?(i(),l("span",C,"已付款")):g("",!0),r.is_paid?g("",!0):(i(),l("span",N,"未付款"))]),t("td",null,[r.is_paid?g("",!0):(i(),l("button",{key:0,class:"btn btn-primary",onClick:u=>d.payOrder(r.id)},"查看付款狀況",8,j))])]))),128))])]),v(f,{pagination:o.pagination,onGetData:d.getOrderList},null,8,["pagination","onGetData"])])}const G=m(x,[["render",E],["__scopeId","data-v-370b40ef"]]);export{G as default};
